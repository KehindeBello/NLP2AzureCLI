<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Result</title>
</head>
<body>
    <h1>Command Result</h1>
    <div id="result-output"></div>

    <div><a href="/home" class="button">Home</a></div>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {

            const outputElement = document.getElementById("result-output");

            //fetch and stream response from the run-command endpoint
            await fetch('/run-command', {method: 'POST'}).then(response => {
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                function readStream() {
                    reader.read().then(({done, value}) => {
                        if (done) {
                            return;
                        }
                        outputElement.innerHTML += decoder.decode(value).replace(/\n/g, "<br>");
                        readStream(); //continue reading the stream
                    });
                }
                readStream();
            });

        });

    </script>
</body>
</html>
